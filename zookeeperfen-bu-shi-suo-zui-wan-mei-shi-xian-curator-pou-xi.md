# zookeeper分布式锁最完美实现Curator剖析

zookeeper分布式锁基于zookeeper中有序节点实现分布有序等待锁队列，通过watch机制监听锁释放，大大提升强锁效率，避免自旋等锁，浪费cpu资源，同时只watch前一个节点可避免锁释放之后通知所有节点重新竞争锁导致的羊群效应。

## 实现步骤

（1）在根节点（持久化节点，eg：/lock）下创建临时有序节点。

（2）获取根节点下所有子节点，判断上一步中创建的临时节点是否是最小的节点。

* 是：加锁成功
* 不是：加锁失败，对前一个节点加watch，收到删除消息后，加锁成功。

（3）执行被锁住的代码块。

（4）删除自己在根节点下创建的节点，解锁成功。



