# **zookeeper如何保证数据一致性剖析**

ZooKeeper服务有两种不同的运行模式。一种是**"独立模式"**\(standalone mode\)，即只有一个ZooKeeper服务器。这种模式较为简单，比较适合于单元测试、测试环境中采用，但是不能保证高可用性和恢复性。在生产环境中的ZooKeeper通常以**"复制模式"**\(replicated mode\)运行于一个计算机集群上，这个计算机集群被称为一个"集合体"\(ensemble\)。保证ZooKeeper服务的高可用性需要**"复制模式"**，通过写多份来冗余数据，那么如何解决写多份带来一致性问题呢？如何解决一致性问题又会带来性能问题？

### 数据一致性需满足哪些特性呢？

1. **顺序一致性 **如果clientA将zookeeper集群中节点A的数据更新为a，之后又将节点A的数据更新为b，期间没有其它客户端对节点A进行更新操作，需保证其它客户端在看到节点A的数据为b时，之后不会看到节点A的数据为a。
2. **原子性 **如果clientA更新zookeeper集群中节点A的数据失败，则不会有客户端会看到这个更新后的结果。
3. **单一系统镜像 **如果client A在同一个会话中连接到一台新的节点，要保证新节点的数据不能滞后于故障节点数据（zookeeper集群中任意节点可提供读服务）。
4. **持久性 **如果一个更新一旦成功，其结果就会持久存在并且不会被撤销。不会受到服务器故障的影响。

### **数据一致性保障机制-ZAP协议**

Zookeeper 是通过 Zab （Zookeeper Atomic Broadcast）协议来保证分布式事务的最终一致性。





